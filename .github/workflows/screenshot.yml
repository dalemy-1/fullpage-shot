name: screenshots

on:
  workflow_dispatch:
    inputs:
      url:
        description: "Target URL"
        required: true
        default: "http://154.48.226.95:802/#/"
      countries:
        description: "Countries (comma separated)"
        required: false
        default: "US,UK,DE,FR,IT,ES,CA,JP"
  schedule:
    - cron: "0 2 * * *"

permissions:
  contents: write

jobs:
  run:
    runs-on: ubuntu-latest
    timeout-minutes: 60

    env:
      WIDTH: "1440"
      HEIGHT: "3200"
      DPR: "2"
      URL: ${{ github.event.inputs.url || 'http://154.48.226.95:802/#/' }}
      COUNTRIES: ${{ github.event.inputs.countries || 'US,UK,DE,FR,IT,ES,CA,JP' }}

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: "20"

      - name: Install dependencies
        run: |
          npm i
          npx playwright install --with-deps chromium

            - name: Run screenshots
        run: |
          node ./multi_country_grid_4x5_v3.mjs "$URL" "grid_all_v3"
          rm -f grid_all_v3.zip
          zip -r grid_all_v3.zip grid_all_v3

      # 仍然保留 artifact（可选）
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: grid_all_v3
          path: grid_all_v3.zip


      # 关键：发布到 Releases/latest，形成固定下载链接
      - name: Create/Update Release (latest)
        uses: ncipollo/release-action@v1
        with:
          tag: latest
          name: Latest build
          allowUpdates: true
          replacesArtifacts: true
          artifacts: "grid_all_v3.zip"
          token: ${{ secrets.GITHUB_TOKEN }}

